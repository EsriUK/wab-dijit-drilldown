String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),Array.prototype.filter||(Array.prototype.filter=function(a){"use strict";var b,c,d,e,f,g=0;if(void 0===this||null===this)throw new TypeError;if(b=Object(this),c=b.length>>>0,"function"!=typeof a)throw new TypeError;for(d=[],e=arguments.length>=2?arguments[1]:void 0,g=0;c>g;g++)g in b&&(f=b[g],a.call(e,f,g,b)&&d.push(f));return d});var _isNullOrEmpty=function(a){return void 0===a||null===a||""===a},_paoSaoNumberRange=function(a,b,c,d){var e="",f="";return _isNullOrEmpty(a)||(e=a.trim()),_isNullOrEmpty(b)||(e+=b.trim()),_isNullOrEmpty(c)||(f=c.trim()),_isNullOrEmpty(d)||(f+=d.trim()),_isNullOrEmpty(e)||_isNullOrEmpty(f)?e+f:e+"-"+f};define(["dojo/_base/declare","esri/tasks/locator","./PickList","./PickListItem","dojo/Deferred"],function(a,b,c,d,e){var f=function(a,b){var c,d,e=0,f=a.length,g="",h=[];for(e=0;f>e;e+=1)c=a[e],d=b[c],_isNullOrEmpty(d)||h.push(d);return h.length>0&&(g=h.join(", ")),g},g=function(a,b,c){var e,g,h,i=0,j=0;for(i=0,j=a.length;j>i;i+=1)e=a[i],g=e.attributes,h=f(c,g),h.length>0&&(b.hasOwnProperty(h)?b[h].addCandidate(e):b[h]=new d({SortDescription:h,Description:h,Addresses:[e],Level:2}))},h=function(a,b){function c(a){for(var b,c,d=new Array,e=0,f=-1,g=0;b=(c=a.charAt(e++)).charCodeAt(0);){var h=46==b||b>=48&&57>=b;h!==g&&(d[++f]="",g=h),d[f]+=c}return d}var d=c(a.toLowerCase()),e=c(b.toLowerCase());for(x=0;d[x]&&e[x];x++)if(d[x]!==e[x]){var f=Number(d[x]),g=Number(e[x]);return f==d[x]&&g==e[x]?f-g:d[x]>e[x]?1:-1}return d.length-e.length};return a([b],{locatorType:"None",streetGrouping:[],premiseGrouping:[],paoFields:{PAO_TEXT:"",PAO_START_NUMBER:"",PAO_START_SUFFIX:"",PAO_END_NUMBER:"",PAO_END_SUFFIX:""},saoFields:{SAO_TEXT:"",SAO_START_NUMBER:"",SAO_START_SUFFIX:"",SAO_END_NUMBER:"",SAO_END_SUFFIX:""},_getPAOText:function(a,b){var c="",d="",e=this.paoFields;return _isNullOrEmpty(a[e.PAO_TEXT])!==!1||b||(c=a[e.PAO_TEXT].trim()),d=_paoSaoNumberRange(a[e.PAO_START_NUMBER],a[e.PAO_START_SUFFIX],a[e.PAO_END_NUMBER],a[e.PAO_END_SUFFIX]),_isNullOrEmpty(d)===!1&&(c+=" "+d),c.trim()},_getSAOText:function(a,b){var c="",d="",e=this.saoFields;return _isNullOrEmpty(a[e.SAO_TEXT])!==!1||b||(c=a[e.SAO_TEXT].trim()),d=_paoSaoNumberRange(a[e.SAO_START_NUMBER],a[e.SAO_START_SUFFIX],a[e.SAO_END_NUMBER],a[e.SAO_END_SUFFIX]),_isNullOrEmpty(d)===!1&&(c+=" "+d),c.trim()},_geocodeHandler:function(a,b,d,e,f){var g=this;try{this.resultsPickList=new c,this._buildPickList(a).then(function(){g._successHandler([g.resultsPickList],"onAddressToLocationsComplete",d,f)})}catch(h){this._errorHandler(h,e,f)}},_getListLevelDescription:function(a,b){var c="",d=this.streetFields;switch(a){case 1:c=[this._getPAOText(b,!1),b[d.STREET_DESCRIPTOR],b[d.LOCALITY_NAME],b[d.TOWN_NAME],b[d.ADMINISTRATIVE_AREA]].filter(Boolean).join(", ");break;case 2:c=[b[d.STREET_DESCRIPTOR],b[d.LOCALITY_NAME],b[d.TOWN_NAME],b[d.ADMINISTRATIVE_AREA]].filter(Boolean).join(", ")}return c},_buildPicklistItem:function(a,b){return new d({SortDescription:this._getPAOText(a,!0),Description:this._getListLevelDescription(1,a),Addresses:[b],Level:1})},_buildPickList:function(a){var b,i,j,k,l,m,n,o,p=new e,q={},r={},s=0,t=0,u=new c,v=this.streetGrouping,w=this.premiseGrouping,x=function(a,b){return h(a.SortDescription,b.SortDescription)};if(!_isNullOrEmpty(a.candidates)&&a.candidates.length>0){b=a.candidates,g(b,q,v);for(j in q)if(q.hasOwnProperty(j)&&q[j].Addresses.length>1){for(r={},k=new d({Description:j,SortDescription:q[j].SortDescription}),l=q[j].Addresses,s=0,t=l.length;t>s;s+=1)o=l[s].attributes,i=f(w,o),n=null,i.length>0&&(n=l[s],n.SortDescription=this._getSAOText(o,!1),r.hasOwnProperty(i)?r[i].addCandidate(n):r[i]=this._buildPicklistItem(o,n));for(m in r)r.hasOwnProperty(m)&&(r[m].Addresses.sort(x),k.addCandidate(r[m]));k.Addresses.sort(x),u.addItem(k)}else u.addItem(q[j]);u.PickListItems.sort(x),this.resultsPickList=u,p.resolve()}else this.resultsPickList=u,p.resolve();return p.promise}})});